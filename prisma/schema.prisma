// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id        Int      @id @default(autoincrement())
  nome      String
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users       User[]
  clientes    Cliente[]
  simulations Simulation[]
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  nome         String?
  role         String   @default("USER") // ADMIN, USER
  tenantId     Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
}

model Cliente {
  id                Int      @id @default(autoincrement())
  tenantId          Int
  nome              String
  cpf               String   @unique
  rendaLiquida      Decimal
  numeroDependentes Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  gastos          GastoEssencial[]
  dividas         Divida[]
  planos          PlanoPagamento[]
  simulacoes      Simulation[]
}

model GastoEssencial {
  id        Int      @id @default(autoincrement())
  clienteId Int
  tipo      String   // MORADIA, ALIMENTACAO, etc.
  valor     Decimal
  descricao String?
  
  cliente   Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
}

model Divida {
  id                Int      @id @default(autoincrement())
  clienteId         Int
  credor            String
  tipo              String   // CONSIGNADO, CARTAO, etc.
  numeroContrato    String?
  valorContratado   Decimal?
  valorPago         Decimal?
  saldoAtual        Decimal
  taxaJurosMensal   Decimal?
  taxaMediaMercado  Decimal?
  cet               Decimal?
  parcelasRestantes Int?
  
  cliente           Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
}

model PlanoPagamento {
  id                     Int      @id @default(autoincrement())
  clienteId              Int
  prazoMeses             Int
  capacidadeMensal       Decimal
  totalDividaConsolidada Decimal
  valorParcelaMensal     Decimal
  descontoGlobal         Decimal?
  carenciaDias           Int?
  dataCriacao            DateTime @default(now())
  
  cliente                Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
}

model Simulation {
  id         Int      @id @default(autoincrement())
  tenantId   Int
  clienteId  Int?
  type       String   // JUDICIAL_UPDATE, BANK_REVISION, LABOR, etc.
  inputData  Json     // Par√¢metros de entrada
  resultData Json     // Resultados calculados
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tenant  Tenant   @relation(fields: [tenantId], references: [id])
  cliente Cliente? @relation(fields: [clienteId], references: [id])
}
